<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Grant's Picks | Ignition Social</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.9.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.9.0/mapbox-gl.js"></script>
<style>
    body { margin: 0; padding: 0; background-color: #000; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }

    /* --- THE CINEMATIC MAP BLUR --- */
    .mapboxgl-canvas { transition: filter 0.5s ease !important; }
    .map-dimmed { filter: blur(4px) brightness(0.4) !important; }

    /* --- BRANDING WATERMARK --- */
    .watermark {
        position: absolute;
        top: 20px;
        left: 20px;
        z-index: 10;
        color: rgba(255, 255, 255, 0.6); /* Low opacity white */
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-decoration: none;
        text-shadow: 1px 1px 0px rgba(0,0,0,0.8); /* Ensures it's readable over light and dark map areas */
        transition: color 0.2s, opacity 0.2s;
    }
    .watermark:hover {
        color: #FF0000; /* Snaps to your brand red when hovered */
        opacity: 1;
    }

    /* --- WELCOME OVERLAY STYLES --- */
    #welcome-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85); z-index: 9999; 
        display: flex; justify-content: center; align-items: center;
        transition: opacity 0.4s ease; 
    }
    .welcome-content {
        background: #fff; padding: 40px 30px; border: 4px solid #FF0000;
        box-shadow: 12px 12px 0px rgba(0,0,0,1); text-align: center; max-width: 320px;
    }
    .welcome-title { font-weight: 900; text-transform: uppercase; font-size: 26px; margin-bottom: 10px; color: #000; }
    .welcome-desc { font-size: 14px; color: #333; margin-bottom: 25px; line-height: 1.5; }
    .welcome-btn {
        background: #FF0000; color: #fff; border: 2px solid #000; padding: 12px 24px;
        font-weight: 900; text-transform: uppercase; cursor: pointer; font-size: 14px;
        letter-spacing: 1px; width: 100%; transition: background 0.2s;
    }
    .welcome-btn:hover { background: #000; }

    /* --- MAP UI STYLES --- */
    .filter-group {
        position: absolute; top: 20px; right: 20px; z-index: 10; 
        background: #fff; padding: 10px; border: 2px solid #FF0000;
    }

    /* --- POPUP STYLES & ANIMATION --- */
    @keyframes floatPopup {
        0% { margin-top: 0px; }
        50% { margin-top: -10px; }
        100% { margin-top: 0px; }
    }
    .mapboxgl-popup { animation: floatPopup 3s ease-in-out infinite; z-index: 20; }
    .mapboxgl-popup-content {
        padding: 15px; border: 3px solid #FF0000; border-radius: 0px; 
        box-shadow: 8px 8px 0px rgba(0,0,0,0.8); max-width: 280px;
    }
    .popup-title { font-weight: 900; text-transform: uppercase; font-size: 18px; margin-bottom: 2px; }
    .popup-meta { font-size: 11px; color: #666; font-weight: bold; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px; }
    .popup-score { color: #FF0000; font-weight: bold; font-size: 14px; margin-bottom: 8px; }
    .popup-img { width: 100%; height: auto; border: 1px solid #000; margin: 8px 0; display: block; }
    .popup-vibe { font-size: 12px; font-style: italic; color: #555; margin-bottom: 8px; }
    .popup-take { font-size: 13px; line-height: 1.4; color: #333; margin-bottom: 12px; border-top: 1px solid #eee; padding-top: 8px; }
    
    .btn-container { display: flex; gap: 5px; }
    .btn { flex: 1; text-align: center; padding: 8px; font-size: 10px; font-weight: bold; text-decoration: none; text-transform: uppercase; }
    .btn-black { background: #000; color: #fff; }
    .btn-outline { border: 1px solid #000; color: #000; }
</style>
</head>
<body>

<div id="welcome-overlay">
    <div class="welcome-content">
        <div class="welcome-title">Grant's Picks</div>
        <div class="welcome-desc">A highly curated, no-bullshit guide to my favorite spots in the city. Good food, good drinks, good vibes only.</div>
        <button class="welcome-btn" id="enter-btn">Explore the Map</button>
    </div>
</div>

<a href="https://instagram.com/grantwillian" target="_blank" class="watermark">Created by @grantwillian</a>

<div id="map"></div>

<div class="filter-group">
    <label style="font-weight:bold; font-size:12px;">FILTER: </label>
    <select id="category-select" style="border:none; outline:none; font-family:inherit; cursor:pointer;">
        <option value="all">Show All</option>
        <option value="Restaurant">Restaurant</option>
        <option value="Bakery/Cafe">Bakery/Cafe</option>
        <option value="Bar/Speakeasy">Bar/Speakeasy</option>
        <option value="Street Food">Street Food</option>
        <option value="Shop">Shop</option>
    </select>
</div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZ3JhbnRzZW50bWUiLCJhIjoiY21semtoaHl5MDgyMzNlb2s3M2J5eGdyMiJ9.O0JLwYp11XNKPZB9FDXgMg';
    
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/grantsentme/cmlzkldac001601scglds8nyx', 
        center: [-73.988, 40.730], 
        zoom: 15.5,
        pitch: 65,
        bearing: -15,
        antialias: true
    });

    // --- NEW: QUALITY OF LIFE CONTROLS ---
    // Adds a button to find the user's GPS location
    map.addControl(new mapboxgl.GeolocateControl({
        positionOptions: { enableHighAccuracy: true },
        trackUserLocation: true,
        showUserHeading: true
    }), 'bottom-right');

    // Adds standard zoom and compass rotate buttons
    map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');


    // --- POPUP & CLICK LOGIC ---
    map.on('click', 'grantsentmemap', (e) => {
        const props = e.features[0].properties;
        const coordinates = e.features[0].geometry.coordinates.slice();

        const imgSource = props['Photo URL'] || props['Photo URL '];
        const socialLink = props['Social Link'] || props['IG Link'];
        const webLink = props['Link to their Website'];
        
        const cuisine = props.Cuisine || '';
        const price = props.Price || '';
        const vibe = props.Vibe || '';

        const metaText = [cuisine, price].filter(Boolean).join(' &bull; ');

        const formatLink = (link) => {
            if (!link) return null;
            let clean = link.trim();
            if (clean.startsWith('@')) return `https://www.instagram.com/${clean.replace('@','')}`;
            if (!clean.startsWith('http')) return `https://${clean}`;
            return clean;
        };

        const html = `
            <div class="popup-title">${props.Name || 'Place Name'}</div>
            ${metaText ? `<div class="popup-meta">${metaText}</div>` : ''}
            <div class="popup-score">SCORE: ${props.Score || 'N/A'}</div>
            
            ${imgSource ? `<img class="popup-img" src="${imgSource.trim()}" onerror="this.style.display='none'">` : ''}
            
            ${vibe ? `<div class="popup-vibe">Vibe: ${vibe}</div>` : ''}
            <div class="popup-take">${props.Review || 'No review yet.'}</div>
            
            <div class="btn-container">
                ${socialLink ? `<a href="${formatLink(socialLink)}" target="_blank" class="btn btn-black">Social</a>` : ''}
                ${webLink ? `<a href="${formatLink(webLink)}" target="_blank" class="btn btn-outline">Website</a>` : ''}
            </div>
        `;

        const popup = new mapboxgl.Popup({ offset: 25 })
            .setLngLat(coordinates)
            .setHTML(html)
            .addTo(map);

        const canvas = map.getCanvas();
        canvas.classList.add('map-dimmed');

        popup.on('close', () => {
            canvas.classList.remove('map-dimmed');
        });

        map.flyTo({
            center: coordinates,
            speed: 0.6,
            curve: 1, 
            offset: [0, -120],
            essential: true 
        });
    });

    // --- CATEGORY FILTER LOGIC ---
    document.getElementById('category-select').addEventListener('change', (e) => {
        const val = e.target.value;
        if (val === 'all') {
            map.setFilter('grantsentmemap', null);
        } else {
            map.setFilter('grantsentmemap', ['==', ['downcase', ['get', 'Category']], val.toLowerCase()]);
        }
    });

    map.on('mouseenter', 'grantsentmemap', () => { map.getCanvas().style.cursor = 'pointer'; });
    map.on('mouseleave', 'grantsentmemap', () => { map.getCanvas().style.cursor = ''; });

    // --- WELCOME OVERLAY LOGIC ---
    document.getElementById('enter-btn').addEventListener('click', () => {
        const overlay = document.getElementById('welcome-overlay');
        overlay.style.opacity = '0'; 
        setTimeout(() => { overlay.style.display = 'none'; }, 400); 
    });

</script>
</body>
</html>
